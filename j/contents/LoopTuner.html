<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html  xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<!-- generated by to_html.pl from LoopTuner.xml -->
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<title>LoopTuner</title>
	<meta name="author" content="W.Dee" />
	<meta http-equiv="Content-Style-Type" content="text/css" />
	<meta http-equiv="Content-Script-Type" content="text/javascript" />
	<link href="browser.css" type="text/css" rel="stylesheet" title="Standard Style for KiriKiri Reference" />
	<link href="mailto:dee@kikyou.info" rev="Made" />
	<link href="index.html" target="_top" rel="Start" title="Top Page" />
</head>
<body>
<h1><a id="id182" name="id182">About LoopTuner</a>
</h1><div class="para"><div>
 LoopTuner is a tool for PCM format files (such as .WAV and Ogg Vorbis) to generate information such as:<br />
<ul><li>"<a id="id183" name="id183" class="targanchor"><dfn>Links</dfn></a>" for setting seamless loops or performing jumps (changing playback position) based on conditions.</li><li>"<a id="id184" name="id184" class="targanchor"><dfn>Labels</dfn></a>" for triggering events in KiriKiri when playback reaches a specific position.</li></ul><br />
 The generated information is saved in a file with .sli appended to the PCM filename (for example, se001.wav.sli for se001.wav). This file is automatically loaded when opening the PCM file with the <a target="main" class="jump" href="f_WaveSoundBuffer.html">WaveSoundBuffer class</a>.<br />
</div></div>

<h1><a id="id185" name="id185">What is a Seamless Loop?</a>
</h1><div class="para"><div>
 Even without LoopTuner, you can perform loop playback using the <a target="main" class="jump" href="f_WaveSoundBuffer_looping.html">WaveSoundBuffer.looping</a> property. However, this only allows simple loops that play from the beginning of the sound to the end and then return to the beginning.<br />
 With LoopTuner, as shown in the figure below, you can set a loop that plays to an arbitrary point and then returns to another arbitrary point. This can be used for looping songs with an anacrusis (pickup notes) or for cases where the sound cannot be repeated from the very beginning, such as an engine starting followed by a continuous engine loop.<br />
<br />
<img width="403" height="199" alt="lt_seamless_loop.png" src="lt_seamless_loop.png" /><br />
<br />
 In these cases, if the timing of the repetition is not strictly adjusted, crackling noises like "clicks" or "pops" will occur at the loop point. LoopTuner includes features to assist in the detailed adjustment of this timing, making it easy to achieve seamless loops.<br />
 Additionally, in rare cases where noise cannot be removed through adjustment alone, LoopTuner has a feature to reduce this noise by performing a very short (approx. 50ms) crossfade near the link point.<br />
</div></div>
<h1><a id="id186" name="id186">Conditional Links</a>
</h1><div class="para"><div>
 Conditional links can be used for scenarios such as "looping a song, but wanting to exit the loop and proceed to the next melody when a certain condition is met."<br />
 In LoopTuner, information for changing the playback position is called a "Link," and conditions can be attached to these links.<br />
 LoopTuner can manage 16 "Flags," which hold values from 0 to 9999. You can set any link to be followed only if a "Condition" is met, such as "Flag No. X is Y," "Flag No. X is not Y," or "Flag No. X is less than or equal to Y."<br />
 Flags can be tested by changing their values within LoopTuner, and they can also be manipulated via script using the <a target="main" class="jump" href="f_WaveSoundBuffer_flags.html">WaveSoundBuffer.flags property</a>.<br />
</div></div>

<h1><a id="id187" name="id187">Labels</a>
</h1><div class="para"><div>
 "Labels" can be set for purposes such as "triggering an event when the playback position reaches a specific point."<br />
 When a label is passed, a <a target="main" class="jump" href="f_WaveSoundBuffer_onLabel.html">WaveSoundBuffer.onLabel</a> event occurs. The label name is passed as a parameter to the event, allowing you to identify which label was passed.<br />
<br />
 Additionally, by setting a special "<a id="id188" name="id188" class="targanchor"><dfn>Expression</dfn></a>" on a label, you can increase, decrease, or set flag values when the label is passed.<br />
 Combining this with the "Conditional Links" mentioned above allows for uses such as playing a specific section exactly four times.<br />
</div></div>
<h1><a id="id189" name="id189">Links, Labels, and Buffering</a>
</h1><div class="para"><div>
 KiriKiri's WaveSoundBuffer always buffers sound. After decoding (reading from a file or expanding compressed audio), it does not play the data immediately; instead, it stores it in a memory area called a buffer before playback.<br />
 This means decoding always happens ahead of the actual playback position, with a maximum discrepancy of 2 seconds under standard settings.<br />
 Since link conditions are tested at the time of decoding, even if you manipulate a flag, the effect may not be realized for up to 2 seconds. Therefore, caution is required as changing a condition just before a link point during playback might not affect that link.<br />
 "Up to 2 seconds" means it may be shorter in some cases. If the CPU has spare capacity and decoding is sufficient, it generally maintains 2 seconds, but if the CPU is busy with other tasks and decoding is delayed, it may drop below 2 seconds.<br />
<br />
 Regarding labels, note that while the label event occurs when the actual "playback position" reaches that point, the label "expression" is executed when the "decoding position" reaches that point.<br />
</div></div>
<h1><a id="id190" name="id190">Supported Formats</a>
</h1><div class="para"><div>
 LoopTuner currently supports the following PCM file formats:<br />
<ul><li>Uncompressed Wave (extension .wav)</li><li>MS-ADPCM (extension .wav)</li><li>Ogg Vorbis (extension .ogg)</li></ul><br />
LoopTuner uses the same plugins as the KiriKiri main body. In the standard distribution, each plugin is detected automatically, so no special configuration is required.<br />
</div></div>

<h1><a id="id191" name="id191">Main Screen</a>
</h1><div class="para"><div>
 When you start LoopTuner (krkrlt.exe), the following screen is displayed (the screen below shows a file actually loaded):<br />
<img width="587" height="251" alt="lt_main_window.png" src="lt_main_window.png" /><br />
<br />
<dl>
<dt>Reduced Waveform Display Area</dt>
<dd> This area displays the entire sound as a reduced waveform. Red horizontal lines represent links, and green vertical lines represent labels.<br />
 Clicking here allows you to display that vicinity in the main waveform display area. Double-clicking starts playback from that position.<br />
 Since creating the reduced waveform takes time, the entire waveform might not be displayed immediately after loading a sound or changing the window width (it will appear over time as the reduced waveform is created in the background).<br />
</dd>


<dt>Timeline/Label Display Area</dt>
<dd> This area displays the timeline, allowing you to see how much time has elapsed from the beginning of the sound at any position.<br />
 Label information is also displayed here. Inverted triangle marks represent labels.<br />
 Clicking a label selects it.<br />
 Double-clicking a label allows you to edit the label name.<br />
</dd>

<dt>Waveform Display Area</dt>
<dd> This area displays the sound waveform.<br />
 You can zoom in or out using [View|Zoom In] or [View|Zoom Out].<br />
 Clicking the waveform displays a blinking vertical bar (called the caret). [Play|Play from Current Position] starts playback from this location. Also, [View|Zoom In] and [View|Zoom Out] center the zoom on this position.<br />
 Double-clicking the waveform starts playback from that position.<br />
 If the waveform does not fit on the screen, a scrollbar appears at the bottom.<br />
 Vertical dotted lines in the waveform display represent label or link positions. These vertical lines can be dragged with the mouse to adjust their positions.</dd>
<dt>Link Display Area</dt>
<dd> This area displays link information.<br />
 Links are shown as arrows, meaning that when the playback position reaches the base of the arrow, it moves to the tip of the arrow.<br />
 Dotted links represent conditional links.<br />
 Clicking a link selects it.<br />
 Double-clicking a link opens the link editing screen.<br />
</dd>



<dt>[File(F)|Open(O) ...](<img width="15" height="13" alt="lt_open.png" src="lt_open.png" />) Shortcut: Ctrl+O</dt>
<dd> Opens a sound file to operate on. If the currently open file has been modified, a dialog box will ask whether to save the changes.</dd>
<dt>[File(F)|Save(S)](<img width="14" height="14" alt="lt_save.png" src="lt_save.png" />) Shortcut: Ctrl+S</dt>
<dd> Saves the current content to a file. The filename will be the PCM filename with .sli appended (e.g., se001.wav.sli for se001.wav).</dd>
<dt>[File(F)|Exit(X)]</dt>
<dd> Exits LoopTuner. If the currently open file has been modified, a dialog box will ask whether to save the changes.</dd>
<dt>[Edit(V)|Undo(U)](<img width="12" height="7" alt="lt_undo.png" src="lt_undo.png" />) Shortcut: Ctrl+Z</dt>
<dd> Cancels the last edit and returns to the previous state.</dd>
<dt>[Edit(V)|Redo(R)](<img width="12" height="7" alt="lt_redo.png" src="lt_redo.png" />)</dt>
<dd> Re-applies a change that was undone with "Undo".</dd>
<dt>[Edit(V)|Delete(D)](<img width="14" height="14" alt="lt_delete.png" src="lt_delete.png" />) Shortcut: Del</dt>
<dd> Deletes the currently selected item.</dd>
<dt>[Edit(V)|Create New Link(J)](<img width="12" height="12" alt="lt_new_link.png" src="lt_new_link.png" />)</dt>
<dd> Creates a new link. The link is created with the last clicked position as the destination and the second-to-last clicked position as the source. Therefore, to create a link, first click the source position, then click the destination position, and finally select this menu item.<br />
</dd>
<dt>[Edit(V)|Create New Label(J)](<img width="9" height="10" alt="lt_new_label.png" src="lt_new_label.png" />)</dt>
<dd> Creates a new label.</dd>
<dt>[Edit(V)|Edit Link(T) ...](<img width="15" height="13" alt="lt_edit_link.png" src="lt_edit_link.png" />)</dt>
<dd> Opens a screen to adjust the currently selected link.</dd>
<dt>[Edit(V)|Create Label at Playback Position(A)](<img width="16" height="16" alt="lt_new_label_on_play.png" src="lt_new_label_on_play.png" />) Shortcut: A or S</dt>
<dd> Creates a label at the current playback position. This allows you to create labels via keypress. If pressing the A key repeatedly is difficult, you can also use the S key; alternating between A and S is easier.</dd>
<dt>[Edit(V)|Delete All Labels(Q)](<img width="16" height="16" alt="lt_clear_all_labels.png" src="lt_clear_all_labels.png" />) Shortcut: Ctrl + Q</dt>
<dd> Deletes all labels.</dd>
<dt>[View(V)|Zoom In(I)](<img width="13" height="13" alt="lt_zoom_in.png" src="lt_zoom_in.png" />) Shortcut: I</dt>
<dd> Enlarges the waveform.</dd>
<dt>[View(V)|Zoom Out(O)](<img width="13" height="13" alt="lt_zoom_out.png" src="lt_zoom_out.png" />) Shortcut: O</dt>
<dd> Reduces the waveform.</dd>
<dt>[View(V)|Follow Playback Position(F)](<img width="13" height="14" alt="lt_follow.png" src="lt_follow.png" />) Shortcut: F</dt>
<dd> Makes the screen follow the playback position.</dd>
<dt>[View(V)|Show Toolbar(T)]</dt>
<dd> Toggles the display of the toolbar.<br />
</dd>


<dt>[View(V)|Show Flags(G)](<img width="12" height="14" alt="lt_edit_flags.png" src="lt_edit_flags.png" />)</dt>
<dd> Displays the flag editing bar.<br />
 The flag editing bar has 16 edit fields, each representing a flag. You can change the values. Double-clicking an edit field toggles the value between 0 and 1.<br />
 Clicking the [C] button at the far left resets all flags to 0.<br />
</dd>
<dt>[View(V)|Show Reduced Waveform(E)]</dt>
<dd> Toggles the display of the reduced waveform.<br />
</dd>
<dt>[View(V)|Show Status Bar(S)]</dt>
<dd> Toggles the display of the status bar.<br />
</dd>


<dt>[Play(P)|Stop(Q)](<img width="8" height="8" alt="lt_stop.png" src="lt_stop.png" />) Shortcut: Q</dt>
<dd> Stops playback.</dd>
<dt>[Play(P)|Play from Start(P)](<img width="12" height="9" alt="lt_play_from_first.png" src="lt_play_from_first.png" />) Shortcut: P</dt>
<dd> Starts playback from the beginning of the sound.</dd>
<dt>[Play(P)|Play from Current Position(C)](<img width="12" height="13" alt="lt_play_from_current.png" src="lt_play_from_current.png" />) Shortcut: Space</dt>
<dd> Starts playback from the caret position.</dd>
<dt>[Play(P)|Ignore Links(G)](<img width="12" height="9" alt="lt_ignore_links.png" src="lt_ignore_links.png" />) Shortcut: G</dt>
<dd> When this item is checked (appears pressed), playback ignores all links. Even if the playback position reaches a link source, it will not follow the link.</dd>
<dt>[Help(H)|Help(H)]</dt>
<dd> Displays the help.</dd>

<dt>[Help(H)|About LoopTuner(A)]</dt>
<dd> Displays copyright and version information for LoopTuner.</dd></dl></div></div>

<h1><a id="id192" name="id192">Link Tuner Screen</a>
</h1><div class="para"><div>
 This screen can be displayed by selecting [Edit|Edit Link] or by double-clicking a link.<br />
 For shortcut keys available on this screen, refer to the menu displayed when right-clicking the waveform.<br />
<br />
<img width="612" height="298" alt="lt_link_tuner.png" src="lt_link_tuner.png" /><br />
<br />
<dl>
<dt>Link Conditions</dt>
<dd> The top section is for editing link conditions.<br />
 By checking the [Conditional] checkbox, you can make this link a conditional link. Specify the condition in the right-hand section.<br />
 Conditions can be specified in the following format:<br />
<br />
 <code class="inlinecode">Flag No. [A] is [B] [Condition]</code><br />
<br />
 [A] specifies the flag number to compare (0 to 15).<br />
 [B] specifies the value to compare against (0 to 9999).<br />
 [Condition] specifies the condition. There are six types: "Equal to", "Not equal to", "Greater than", "Greater than or equal to", "Less than", and "Less than or equal to".<br />
<br />
 While values from 0 to 9999 can be used for comparison, it is generally better to use 0 or 1 unless you have a special purpose (0 and 1 can be easily entered by double-clicking in the flag editing bar on the main screen).<br />
</dd>
<dt>Waveform Display Area</dt>
<dd> In the waveform display area, you can check the waveform immediately before and after the link. The blue waveform on the left is before the link, and the red waveform on the right is after the link. The faint waveforms represent the "after" waveform overlaid on the "before" side, and vice versa.<br />
 The waveforms can be adjusted by dragging with the mouse. They can also be adjusted using the link adjustment buttons located below the waveform display.<br />
</dd>
<dt>Link Adjustment Buttons</dt>
<dd> There are 12 link adjustment buttons; the 6 on the left adjust the position before the link, and the 6 on the right adjust the position after the link.<br />
<dl>    
<dt>To Previous Crossing Point(<img width="12" height="16" alt="lt_left_cross_point.png" src="lt_left_cross_point.png" />)</dt>
    <dd>Finds the previous crossing point (where the waveform crosses the -Inf line) and moves there.</dd>
    
<dt>20 steps back(<img width="12" height="14" alt="lt_20_step_left.png" src="lt_20_step_left.png" />)</dt>
    <dd>Moves back 20 steps. One step depends on the waveform zoom; if the zoom is 1/16, it is 16 samples; if 1/1, it is 1 sample.</dd>
    
<dt>1 step back(<img width="11" height="14" alt="lt_1_step_left.png" src="lt_1_step_left.png" />)</dt>
    <dd>Moves back 1 step.</dd>
    
<dt>1 step forward(<img width="11" height="14" alt="lt_1_step_right.png" src="lt_1_step_right.png" />)</dt>
    <dd>Moves forward 1 step.</dd>
    
<dt>20 steps forward(<img width="12" height="14" alt="lt_20_step_right.png" src="lt_20_step_right.png" />)</dt>
    <dd>Moves forward 20 steps.</dd>
    
<dt>To Next Crossing Point(<img width="12" height="15" alt="lt_right_cross_point.png" src="lt_right_cross_point.png" />)</dt>
    <dd>Finds the next crossing point (where the waveform crosses the -Inf line) and moves there.</dd></dl></dd>

<dt>Zoom Buttons(<img width="13" height="13" alt="lt_zoom_in.png" src="lt_zoom_in.png" /><img width="13" height="13" alt="lt_zoom_out.png" src="lt_zoom_out.png" />)</dt>
<dd> Changes the zoom level. The zoom level is displayed next to these buttons as /1, etc. /1 represents 1/1 (1 pixel per sample). /16 represents 1/16 (1 pixel per 16 samples).<br />
</dd>
<dt>Smooth Link(<img width="14" height="10" alt="lt_smooth.png" src="lt_smooth.png" />)</dt>
<dd> Makes the link smooth. When this button is checked (appears pressed), LoopTuner and KiriKiri will play the waveforms before and after the link mixed with a short crossfade (50ms). This can reduce crackling noises like "clicks" or "pops" that occur when the waveforms before and after the link do not match well.<br />
</dd>
<dt>Stop Playback(<img width="8" height="8" alt="lt_stop.png" src="lt_stop.png" />)</dt>
<dd> Stops playback.<br />
</dd>
<dt>Play(<img width="77" height="15" alt="lt_play_before.png" src="lt_play_before.png" />)</dt>
<dd> Plays the vicinity of the link. You can play from 0.5s, 1s, 2s, 3s, or 5s before the link.<br />
 When a playback button is clicked, it becomes marked (changes color). Subsequently, pressing the Space key performs the same action as clicking that button (plays from the same duration before the link as the last clicked button).<br />
</dd>
<dt>[OK] Button</dt>
<dd> Confirms changes and closes the window.</dd>
<dt>[Cancel] Button</dt>
<dd> Discards changes and closes the window.</dd></dl>
<br /><div class="note"><div class="notehead"><span class="noteheadspan">Note</span></div>
 If an unconditional link and one or more conditional links have the same source position, the conditional link tests take priority. If none of the conditions are met, the unconditional link is followed.<br />
 If there are multiple unconditional links, which one is used is undefined.<br />
 If there are multiple conditional links, the order of testing is undefined.<br />
 In this context, "same position" means strictly the exact same position. If the position differs by even one sample, they are not considered the same position.<br />
</div><br />

</div></div>

<h1><a id="id193" name="id193">Label Expressions</a>
</h1><div class="para"><div>
 Labels can perform special processing on flags when passed by setting an "Expression" in a special format.<br />
 To write an "Expression" in a label, the label name must start with a ':' (colon).<br />
 An expression consists of the target flag, an "<a id="id194" name="id194" class="targanchor"><dfn>Operator</dfn></a>" representing the process to perform, and an "<a id="id195" name="id195" class="targanchor"><dfn>Operand</dfn></a>" as a parameter for the operator (some operators do not have operands).<br />
 The target flag is specified by enclosing the flag number (0 to 15) in '[' ']' (brackets). For operands, numerical values are written as is, and if you want to specify another flag, enclose its number (0 to 15) in '[' ']' (brackets).<br />
 The following operators are available:<br />
<dl>
<dt>=</dt>
<dd>Assigns the operand value to the flag.</dd>
<dt>+=</dt>
<dd>Adds the operand value to the flag.</dd>
<dt>-=</dt>
<dd>Subtracts the operand value from the flag.</dd>
<dt>++</dt>
<dd>Increments the flag value by 1.</dd>
<dt>--</dt>
<dd>Decrements the flag value by 1.</dd></dl> In all cases, the flag value range is strictly 0 to 9999. Values below 0 are corrected to 0, and values above 9999 are corrected to 9999.<br />
<br />
Examples:<br />
<code class="inlinecode">:[0]=1    </code>Assigns 1 to flag No. 0.<br />
<code class="inlinecode">:[1]=[0]  </code>Assigns the value of flag No. 0 to flag No. 1.<br />
<code class="inlinecode">:[1]+=3   </code>Adds 3 to flag No. 1.<br />
<code class="inlinecode">:[0]++    </code>Increments flag No. 0 by 1.<br />
<br /><div class="note"><div class="notehead"><span class="noteheadspan">Note</span></div>
 If multiple labels are at the same position, the order of execution is undefined.</div><br />
</div></div>


<h1><a id="id196" name="id196">Hints and Tips</a>
</h1><div class="para"><div>
<dl>
<dt>Adjusting Links</dt>
<dd> At the PCM seam created by a link, crackling noise will occur if the adjustment is poor. While you can reduce this noise using the "Smooth Link" feature, it is recommended to first attempt adjustment without it.<br />
<br />
 For music generated in electronic environments like sound modules and sequencers, you can often find points that match almost perfectly before and after the link, as shown below.<br />
<img width="598" height="198" alt="lt_link_tuner_wave_match.png" src="lt_link_tuner_wave_match.png" /><br />
<br />
 Even if some noise is inevitable, the following points can help make it less noticeable:<br />
<ul><li>Placing the seam immediately before a snare or cymbal drum hit makes noise less noticeable. Points before high-pitched or percussive sounds are also favorable.</li><li>Placing the seam at a crossing point makes noise less noticeable.</li></ul></dd>

<dt>Controlling Song Progression with Conditional Links</dt>
<dd> You can realize song progression control that reflects game progress or scenes—such as starting with an intro, looping, and then exiting the loop to enter another loop based on certain conditions—using conditional links and flag manipulation.<br />
 However, links only operate at the positions pre-specified in LoopTuner. Even if you change a link condition, the playback position will not change until the link position is reached.<br />
 If a loop is long and the inability to exit until reaching the end is a problem, you must design the song structure so that it can exit mid-loop.<br />
 For example, as shown below:<br />
<br />
<img width="513" height="311" alt="lt_complex_loop.png" src="lt_complex_loop.png" /><br />
 At the start of playback, Flag 0 is 0. The "Intro" plays, and the "Loop" section repeats.<br />
 Here, if the game progresses and Flag 0 becomes 1, the "Loop" will be exited at either point (1) or (2).<br />
 If exiting at (1), it plays through the "(1) to (3) transition" to (3), and then the "Remaining Part" plays.<br />
 If exiting at (2), after the "(2) to (3) transition," it jumps to (3) via a link, and the "Remaining Part" plays.<br />
<br />
 Many different applications can be considered.<br />
</dd>
</dl>
</div></div>


	<script type="text/javascript" charset="UTF-8" src="documentid.js" ></script>
	<script type="text/javascript" charset="UTF-8" src="postcontent.js" ></script>
</body>
</html>