<?xml version="1.0" encoding="UTF-8" ?>
<doc>
<title>Event System</title>

<para>
<ptitle>About the Event System</ptitle>
 When writing TJS scripts in KiriKiri, you must adopt an event-driven programming model.<r/>
 Events occur to notify other objects or the object itself when "something has happened." You will write processing to respond to these in event handlers.<r/>
 In KiriKiri, it is not desirable for a single event handler to take an unnecessarily long time. If you want to wait for a period of time, it is recommended to use the <at href="f_Timer.html">Timer</at> class.<r/>
</para>

<para>
<ptitle>Synchronous and Asynchronous Events</ptitle>
 Synchronous events are events that occur immediately on the spot when an object is operated, such as the onStatusChanged event occurring within the play method when starting playback in a sound buffer.<r/>
 In contrast, asynchronous events are temporarily stored in the event queue (a place where events to be triggered are temporarily kept) inside KiriKiri. These events do not occur until all other event handler processing is finished, and they do not occur within other event handlers (though there are exceptions, see the note below). Events such as the onTimer event that occurs when a timer period arrives, and all events triggered by user input, are asynchronous events.<r/>
<note>
 Some functions that attempt to get user input, such as Window.showModal, may cause the event queue to operate (dispatch events). This makes it possible for another asynchronous event to occur within an event handler.
</note>
 The <at href="f_AsyncTrigger.html">AsyncTrigger</at> class exists to trigger asynchronous events via script operations.<r/>
</para>

<para>
<ptitle>Screen Update Timing</ptitle>
 The timing for screen updates to display layers in a window is the same as asynchronous events: after all other event handler processing has been performed. No matter how many times drawing is performed within a single event handler, it is drawn to the internal image buffer, but it is not immediately reflected on the screen. Only when the event handler is exited and KiriKiri gains the timing for drawing will the content be drawn and reflected in the window.<r/>
</para>

<para>
<ptitle>Event Handlers within Classes</ptitle>
 Events occurring within a class can be handled within that class by overriding the superclass's event handler.<r/>
 For example, you can create a subclass from the Timer class and create an event handler as follows.<r/>
<bq>
class MyTimer extends Timer<r/>
{<r/>
	function MyTimer()<r/>
	{<r/>
		super.Timer(...);<r/>
	}<r/>
<r/>
	function onTimer()<r/>
	{<r/>
		// ( onTimer processing goes here )<r/>
		super.onTimer(...); // Call the superclass method just in case<r/>
	}<r/>
}<r/>
</bq>
 It is not strictly necessary to call the superclass method, but it is generally done. Also, if the superclass method is not called, event handling via the action method described later cannot be performed.<r/>
</para>

<para>
<ptitle>action Method</ptitle>
 Classes such as the <at href="f_Layer.html">Layer</at> class and <at href="f_WaveSoundBuffer.html">WaveSoundBuffer</at> class have the ability to trigger events in the action method of the owner specified in the constructor.<r/>
 A single dictionary array object argument is passed to the action method, which contains the event information.<r/>
 Among the members of the dictionary array, target represents the object that triggered the event. type represents the event name.<r/>
 Other members vary depending on the event. For example, in the case of the <at href="f_Layer_onClick.html">Layer.onClick</at> event, there are members named x and y, representing the location where the layer was clicked.<r/>
<bq>
Example:<r/>
class MyWindow extends Window<r/>
{<r/>
	var layer;<r/>
	(omitted)<r/>
	function MyWindow()<r/>
	{<r/>
		super.Window(...);<r/>
		add(layer = new Layer(this /* this = owner */, null));<r/>
		layer.visible = true;<r/>
	}<r/>
	(omitted)<r/>
	function action(ev)<r/>
	{<r/>
		if(ev.type == "onClick" &amp;&amp; ev.target == layer)<r/>
		{<r/>
			// layer was clicked<r/>
			System.inform(ev.x, ev.y);<r/>
		}<r/>
	}<r/>
}<r/>
</bq>
</para>

</doc>