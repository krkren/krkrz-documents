<?xml version="1.0" encoding="UTF-8" ?>
<doc>
<title>Image Format Converter</title>

<para>
<ptitle>About the Image Format Converter</ptitle>
 The Image Format Converter (krkrtpc.exe in the tools folder) is a tool for converting KiriKiri images between various formats.<r/>
 It can be used to prepare various types of images.<r/>
<r/>
 For input file formats, you can choose from BMP, PNG, JPEG, and PSD. For output file formats, you can choose from BMP, PNG, TLG5, TLG6, or JPEG.<r/>
 It can also read and output transparent images in the main/mask separation format used by KiriKiri. The term "mask" used here is synonymous with the alpha channel.<r/>
<r/>
 Since it basically just converts image formats, the images output by this tool can likely be used in other software and tools as well.<r/>
<r/>
 Also, while this is not limited to this tool, <b>don't forget to make backups!</b><r/>
</para>

<para>
<ptitle>Input Image Formats</ptitle>
 The following formats can be used as input file formats.<r/>
<r/>
<dl>
<dt>BMP</dt>
<dd>
 Standard Windows bitmap format. 32-bit (bpp) BMPs are treated as BMPs with an alpha channel.<r/>
 BMPs in other formats are treated as opaque images (images without transparency information), except when used in the main/mask separation format described later.
</dd>

<dt>PNG</dt>
<dd>
 Portable Network Graphic format. PNGs with transparent parts (containing an alpha channel or transparency information) can also be read.
</dd>

<dt>PSD</dt>
<dd>
 The format used by Adobe Photoshop 3 and later. However, there are significant limitations to the PSD files that can be read by this tool:<r/>
<r/>
<ul>
<li>Cannot read color modes other than RGB</li>
<li>Cannot read 16-bit/channel images</li>
<li>Only supports Uncompressed and RLE compression (Photoshop 3.0 format supports RLE compression only)</li>
</ul>
<r/>
 This format cannot be read as a main/mask separation format.
 Most data can be read, but some data may not be readable.<r/>
 If you are using a color mode other than RGB (such as CMYK), please convert it to RGB. If you are using 16-bit/channel, please convert it to 8-bit/channel.<r/>
 If the file contains layers with blend modes other than "Normal", it should be fine if you "Merge Visible" before inputting it into this tool.<r/>
<r/>
 The PSD file reading functionality changes significantly depending on whether "Output in ltAddAlpha format" is selected in the output settings.<r/>
<r/>
 If "Output in ltAddAlpha format" is NOT selected, you can read PSD files containing layers with "Normal", "Linear Dodge", "Linear Burn", "Multiply", "Screen", "Overlay", "Hard Light", "Soft Light", "Color Dodge", "Color Burn", "Lighten", "Darken", "Difference", and "Exclusion". Also, if the image consists only of "Normal" layers, it can handle multiple overlapping layers (for other modes, it cannot handle multiple overlapping layers).<r/>
<r/>
 If "Output in ltAddAlpha format" IS selected, it only supports "Normal" layers and "Linear Dodge" layers. In this case, the layers must be ordered from bottom (back) to top as: "any number of 'Normal' layers" followed by "any number of 'Linear Dodge' layers". "Any number" means 0 (no layers at all) or 1 or more layers.<r/>
<dl>
<dt>Examples of readable configurations when "Output in ltAddAlpha format" is selected</dt>
<dd>
    <ul>
        <li>One "Linear Dodge" layer on top of one "Normal" layer</li>
        <li>No "Normal" layer, and only one "Linear Dodge" layer</li>
        <li>One "Normal" layer only</li>
        <li>Two "Linear Dodge" layers on top of three "Normal" layers</li>
    </ul>
</dd>
<dt>Examples of unreadable configurations when "Output in ltAddAlpha format" is selected</dt>
<dd>
    <ul>
        <li>One "Normal" layer on top of one "Linear Dodge" layer, with another "Normal" layer on top of that<r/>(Linear Dodge layers cannot be sandwiched between Normal layers)</li>
        <li>One "Linear Dodge" layer on top of one "Normal" layer, with another "Linear Dodge" layer on top of that<r/>(Normal layers cannot be sandwiched between Linear Dodge layers)</li>
        <li>One "Dodge" layer only<r/>(Even if it's a dodge mode, only "Linear Dodge" layers can be handled)</li>
    </ul>
</dd>
</dl>
Photoshop's "Normal" corresponds to KiriKiri's alpha blending, and "Linear Dodge" corresponds to KiriKiri's additive blending. Since ltAdditiveAlpha (additive alpha blending) can represent both alpha blending and additive blending simultaneously, Photoshop data with such layer configurations can be read.<r/>
<r/>


</dd>

<dt>JPEG</dt>
<dd>
 General full-color and grayscale JPEG formats can be read. They can also be used as input for the main/mask separation format described later.</dd>

<dt>Main/Mask Separation Format</dt>
<dd>
 The main/mask separation format is one where the main (color information) image and the mask (transparency information) image are in separate files.<r/>
 The mask image file name is the main image file name with _m appended to the end (for example, test_m.jpg for test.jpg).<r/>
 Valid input image formats for the main/mask separation format are BMP, JPEG, and PNG. The formats for the main and mask images do not have to be the same.
</dd>
</dl>
<note>
 TLG5 and TLG6 formats cannot be used as input. ERI format is currently not supported.
</note>
</para>

<para>
<ptitle>Output Image Formats</ptitle>
 The following formats can be used as output image formats.<r/>
<r/>
<dl>
<dt>24-bit/32-bit BMP</dt>
<dd>
 24-bit BMP is a BMP without an alpha channel.<r/>
 32-bit BMP is a BMP with an alpha channel, containing both main and mask information within a single file.
</dd>

<dt>PNG</dt>
<dd>
 Full-color PNG or PNG with an alpha channel.<r/>
</dd>

<dt>TLG5</dt>
<dd>
 Full-color TLG5 or TLG5 with an alpha channel.<r/>
<note>
 TLG5 format takes a considerable amount of time to compress. It may look like the program has stopped responding.
</note>
</dd>

<dt>TLG6</dt>
<dd>
 Full-color TLG6 or TLG6 with an alpha channel.<r/>
<note>
 Like TLG5, TLG6 format takes a considerable amount of time to compress. It may look like the program has stopped responding.
</note>
For TLG6 images, tag information is written out just like with TLG5 images.<r/>
</dd>

<dt>Main/Mask Separation Format</dt>
<dd>
 For images with transparent parts, this method records the main and mask in separate files. You can select BMP, JPEG, or PNG for each.<r/>
 The mask image file name is the main image file name with _m appended to the end (for example, test_m.jpg for test.jpg).<r/>
 While you can use different image formats for the main and mask, combinations like BMP and BMP or PNG and PNG make little sense, so it is better to select 32-bit BMP or PNG with an alpha channel as mentioned above.<r/>
 Using JPEG for one or both can save file size, but the image quality will decrease.<r/>
 TLG5 and TLG6 formats cannot be specified for the main/mask separation format.
</dd>
</dl>
</para>

<para>
<ptitle>Tag Information</ptitle>
The Image Format Converter writes "tag information" to TLG and PNG images. "Tag information" includes data such as how the image should be displayed. This tag information can be obtained as the return value of the <at href="f_Layer_loadImages.html">Layer.loadImages</at> method.<r/><r/>
The following tag information is written out:<r/>
<dl>
<dt><kw>mode</kw> (TLG only)</dt>
<dd>
The display mode of the image. For "opaque images", mode=opaque is written, and if the output format is ltAddAlpha, mode=addalpha is written.<r/>
For "images with transparent parts", if the output format is not ltAddAlpha, it will be mode=alpha if a non-PSD file or a PSD file containing only "Normal" layers is read. If a PSD file with layers other than "Normal" is read, information corresponding to each blend mode will be written.<r/>
In KAG, this corresponds directly to the mode attribute of the image tag and becomes the default value when the mode attribute is omitted in the image tag. In other words, in KAG, the appropriate mode attribute is automatically set for the image even if you don't specify it.<r/>
<r/>
 KiriKiri has a dictionary array called imageTagLayerType in the TJS global object, which represents how the mode in the TLG image tag information corresponds to the layer type, defined as follows:<r/>
<bq>
global.imageTagLayerType = %[<r/>
    opaque      :%[type:ltOpaque            ],<r/>
    rect        :%[type:ltOpaque            ],<r/>
    alpha       :%[type:ltAlpha             ],<r/>
    transparent :%[type:ltAlpha             ],<r/>
    addalpha    :%[type:ltAddAlpha          ],<r/>
    add         :%[type:ltAdditive          ],<r/>
    sub         :%[type:ltSubtractive       ],<r/>
    mul         :%[type:ltMultiplicative    ],<r/>
    dodge       :%[type:ltDodge             ],<r/>
    darken      :%[type:ltDarken            ],<r/>
    lighten     :%[type:ltLighten           ],<r/>
    screen      :%[type:ltScreen            ],<r/>
    psnormal    :%[type:ltPsNormal          ],<r/>
    psadd       :%[type:ltPsAdditive        ],<r/>
    pssub       :%[type:ltPsSubtractive     ],<r/>
    psmul       :%[type:ltPsMultiplicative  ],<r/>
    psscreen    :%[type:ltPsScreen          ],<r/>
    psoverlay   :%[type:ltPsOverlay         ],<r/>
    pshlight    :%[type:ltPsHardLight       ],<r/>
    psslight    :%[type:ltPsSoftLight       ],<r/>
    psdodge     :%[type:ltPsColorDodge      ],<r/>
    psdodge5    :%[type:ltPsColorDodge5     ],<r/>
    psburn      :%[type:ltPsColorBurn       ],<r/>
    pslighten   :%[type:ltPsLighten         ],<r/>
    psdarken    :%[type:ltPsDarken          ],<r/>
    psdiff      :%[type:ltPsDifference      ],<r/>
    psdiff5     :%[type:ltPsDifference5     ],<r/>
    psexcl      :%[type:ltPsExclusion       ],<r/>
]<r/>
</bq>
 Please refer to <link href="GraphicSystem" /> for each layer type.
</dd>

<dt><kw>offs_x</kw> <kw>offs_y</kw> <kw>offs_unit</kw> (TLG, PNG)</dt>
<dd>
 These are output only if the source is a PNG and that PNG contains offset information (oFFs chunk) from the top-left corner of the image.<r/>
 offs_x is the distance from the left edge, and offs_y is the distance from the top edge. offs_unit will be either <kw>pixel</kw> or <kw>micrometer</kw>, indicating the unit of distance.<r/>
</dd>

<dt><kw>vpag_w</kw> <kw>vpag_h</kw> <kw>vpag_unit</kw> (TLG, PNG)</dt>
<dd>
 These are output only if the source is a PNG and that PNG contains Virtual PAGe information, i.e., the size of the entire image (vpAg chunk).<r/>
 One software that outputs this information to PNG is the <at target="_top"  href="http://www.imagemagick.org/">ImageMagick</at> utility; when a trim is performed with <kw>ImageMagick</kw>, this information is output as the image size before trimming.<r/>
 vpag_w is the width of the entire image, vpag_h is the height of the entire image, and offs_unit will be either <kw>pixel</kw> or <kw>micrometer</kw>, indicating the unit of size.<r/>
</dd>

<dt><kw>reso_x</kw> <kw>reso_y</kw> <kw>reso_unit</kw> (TLG, PNG)</dt>
<dd>
 These are output only if the source is a PNG and that PNG contains resolution information (pHYs chunk) for the image.<r/>
 reso_x is the horizontal resolution, and reso_y is the vertical resolution. reso_unit will be <kw>meter</kw>, indicating the unit of resolution.<r/>
</dd>

</dl>

</para>

<para>
<ptitle>How to Use the Image Format Converter</ptitle>
<r/>
 Conversion can be performed by dropping the files you want to convert onto the Image Format Converter window. You can also drop multiple files.<r/>
<r/>
 You can specify different formats for opaque images and images with transparent parts.<r/>
<r/>
 An "opaque image" here refers to an image where the entire area is completely opaque (for example, background images used in KAG). An "image with transparent parts" refers to an image that has parts that become transparent (for example, foreground images used in KAG).<r/>
 Note that even if an image format supports transparency, if all pixels in the resulting image are completely opaque, it will be treated as an "opaque image".<r/>
<r/>
 After conversion is finished, a log will be displayed where you can check whether the conversion of each file was successful or if an error occurred.<r/>
<r/>
 Below is a description of the screen.<r/>
<r/>
<img src="TPC.png"/><r/><r/>
 When executed, the screen above is displayed.<r/>
<r/>
<dl>
<dt>"Show Options"</dt>
<dd>
 When checked, the settings section below is displayed. When unchecked, the window consists only of the top part and becomes horizontally narrow. You can make the window compact when option settings are not needed.
</dd>

<dt>"Opaque Image - 24bit BMP"</dt>
<dd>
 Selects 24-bit BMP as the output format for opaque images.
</dd>

<dt>"Opaque Image - PNG"</dt>
<dd>
 Selects PNG as the output format for opaque images.
</dd>

<dt>"Opaque Image - TLG5"</dt>
<dd>
 Selects TLG5 as the output format for opaque images.
</dd>

<dt>"Opaque Image - TLG6"</dt>
<dd>
 Selects TLG6 as the output format for opaque images.
</dd>

<dt>"Opaque Image - JPEG"</dt>
<dd>
 Selects JPEG as the output format for opaque images.
</dd>

<dt>"Opaque Image - JPEG Options..."</dt>
<dd>
 Selects the JPEG compression quality when JPEG is selected as the output format for opaque images.
</dd>


<dt>"Image with Transparent Parts - 32bit BMP (Main+Mask)"</dt>
<dd>
 Selects 32-bit BMP as the output format for images with transparency information.
</dd>

<dt>"Image with Transparent Parts - PNG with Alpha Channel (Main+Mask)"</dt>
<dd>
 Selects PNG with an alpha channel as the output format for images with transparency information.
</dd>

<dt>"Image with Transparent Parts - TLG5 with Alpha Channel (Main+Mask)"</dt>
<dd>
 Selects TLG5 with an alpha channel as the output format for images with transparency information.
</dd>

<dt>"Image with Transparent Parts - TLG6 with Alpha Channel (Main+Mask)"</dt>
<dd>
 Selects TLG6 with an alpha channel as the output format for images with transparency information.
</dd>

<dt>"Image with Transparent Parts - Main/Mask Separation Format"</dt>
<dd>
 Specifies the main/mask separation format as the output format for images with transparency information. Select what to use for the main/mask below. Also, for JPEG, you can select the JPEG compression quality by clicking the "JPEG Options" button.
</dd>

<dt>"Image with Transparent Parts - Treat input image as ltAddAlpha format"</dt>
<dd>
 If this option is checked, the input image is treated as being in ltAddAlpha format, i.e., an additive alpha blending format suitable for display by specifying ltAddAlpha in KiriKiri's <at href="f_Layer_type.html">Layer.type</at> property. The input image formats affected by this option are BMP, PNG, and main/mask separation format; PSD format is not affected.<r/>
 If this option is not checked, the input image is treated as being in ltAlpha format. Since the output format of most graphics software and the PNG specification are in ltAlpha format, this option should normally not be checked.<r/>
 If this option is not checked and "Output in ltAddAlpha format" described below is checked, the Image Format Converter will perform conversion from ltAlpha format to ltAddAlpha format.<r/>
 Checking this option automatically checks the "Output in ltAddAlpha format" option. Also, the "Color info for fully transparent areas" option becomes unavailable (neither alpha nor color information will be processed by the Image Format Converter).<r/>
</dd>


<dt>"Image with Transparent Parts - Output in ltAddAlpha format"</dt>
<dd>
 If this option is checked, the output image will be in ltAddAlpha format.<r/>
 If this option is not checked, the output image format will be ltAlpha format, or in the case of input from a PSD file, a format corresponding to the blend mode of the layers contained in that file.<r/>
 Since various graphics software and the PNG specification only accept images in ltAlpha format, do not check this normally unless you are using the output image specifically for KiriKiri.<r/>
 If this option is checked, the "Color info for fully transparent areas" option becomes unavailable (neither alpha nor color information will be processed by the Image Format Converter).<r/>
</dd>


<dt>"Image with Transparent Parts - Color info for fully transparent areas"</dt>
<dd>
 Specifies the processing for completely transparent parts of the image.<r/>
 Normally, in the case of an ltAlpha format image, even completely transparent parts have color information. Those parts are simply ignored when displaying because they are completely transparent, but they are not ignored when processing the image (including compression by JPEG, etc.).<r/>
 Specifies the processing method for these completely transparent parts.<r/>
<r/>
<dl>
<dt>Remove</dt>
<dd>
 If Remove is specified, color information in completely transparent parts is removed (more accurately, filled with solid black).<r/>
 Normally, this setting is fine.
</dd>

<dt>Keep</dt>
<dd>
 No processing is performed. It remains as the original image.<r/>
 If there is noise in the completely transparent parts, that noise will also be compressed, resulting in poor compression ratios.
</dd>

<dt>Synthesize</dt>
<dd>
 The color of completely transparent parts is estimated and synthesized from the colors of the surrounding opaque parts.<r/>
 You can choose the synthesis strength from 1, 2, 3, 5, or 8 pixels. The color of completely transparent parts is synthesized from the colors of opaque pixels within the distance specified here in pixels. Larger values take more time to process. Colors in completely transparent parts outside the distance specified here are removed.<r/>
 For example, when compressing a main image with JPEG, mosquito noise occurs in places with sudden color changes due to the characteristics of JPEG. In the case of a foreground image, if "Synthesize" processing is not performed and there is a sudden color change at the boundary between completely transparent and opaque parts, noise is likely to occur in that area. By performing "Synthesize" processing, the color of the completely transparent part is synthesized from the color of the opaque part, suppressing the difference in color change and reducing the occurrence of mosquito noise. Also, in general JPEG, color information mixes with adjacent pixels, but by performing "Synthesize" processing, you can suppress the unintended mixing of colors between completely transparent and opaque parts (which would happen if not synthesized).<r/>
 Normally, please select "Remove". Color information is not needed in completely transparent parts. Also, removing it can reduce the file size after image compression.
</dd>
</dl>
 This option is unavailable if "Output in ltAddAlpha format" is checked. This is because "completely transparent" in ltAddAlpha format cannot be anything other than opacity 0 and color solid black.<r/>
</dd>

<dt>"Output Folder - Same folder as input file"</dt>
<dd>
 Outputs the file to the same folder as the input file.
</dd>

<dt>"Output Folder - Specified folder"</dt>
<dd>
 Outputs the file to the folder specified in the input field below.<r/>
 Clicking the "Browse..." button allows you to display a dialog box to select the output folder.<r/>
 If a relative folder is specified in the input field, it can be specified as a relative position from the folder where the input file is located.
</dd>

<dt>"Output Folder - Overwrite if a file with the same name exists"</dt>
<dd>
 If this checkbox is checked, it will overwrite if a file with the same name exists.
</dd>

<dt>"Do not show log if no errors occurred"</dt>
<dd>
 If this checkbox is checked, the window for checking the log will not be displayed if the conversion finishes and no errors occurred during conversion.
</dd>

<dt>"Close"</dt>
<dd>
 Exits this tool.
</dd>
</dl>
</para>


</doc>