<?xml version="1.0" encoding="UTF-8" ?>
<doc>
<title>About Plugins</title>

<para>
<ptitle>What are Plugins?</ptitle>
 Plugins are used to connect to Kirikiri and extend its functionality.<r/>
 Currently, there are three types of plugins available for Kirikiri:<r/>
<ul>
<li>Susie Plug-in (Image loading and archive access)</li>
<li>Plugins to extend formats playable by WaveSoundBuffer</li>
<li>Other Kirikiri-specific plugins</li>
</ul>
 <r/>
<r/>
 To use a plugin, you must connect it to the Kirikiri core using the <at href="f_Plugins_link.html">Plugins.link</at> method.<r/>
</para>


<para>
<ptitle>Searching for Plugins</ptitle>
 The <at href="f_Plugins_link.html">Plugins.link</at> method searches for the specified plugin in the following order:<r/>
<ol>
<li>The same folder as the Kirikiri executable</li>
<li>Inside the plugin (or plugin64 for 64-bit versions) folder located in the same directory as the Kirikiri executable</li>
<li>Auto-search path</li>
</ol>
<r/>
 If the auto-search path is in a location that cannot be accessed as a local file, such as inside an archive, Kirikiri will attempt to extract the plugin to the **same folder as the Kirikiri executable**. Since this can cause issues, it is **strongly recommended** to place plugins in either "the same folder as the Kirikiri executable" or "the plugin folder in the same directory as the Kirikiri executable".
<r/>
 Placing them in the plugin/plugin64 folders is also important for distinguishing between 32-bit and 64-bit plugins.<r/>
 Additionally, Kirikiri configuration tools (such as Releaser or the -userconf option) search for plugins to collect information on embedded options for each plugin in the following order:<r/>
<ol>
<li>The same folder as the Kirikiri executable</li>
<li>Inside the plugin folder in the same directory as the Kirikiri executable</li>
</ol>
<r/>
 Since Kirikiri configuration tools do not search the auto-search path, plugins containing configuration items must be placed in "the same folder as the Kirikiri executable" or "the plugin folder in the same directory as the Kirikiri executable".<r/>
</para>

<para>
<ptitle>Automatic Plugin Loading</ptitle>
 Kirikiri has a feature to automatically search for and load plugins at startup. To have a plugin loaded automatically, you must change the plugin's extension from dll to tpm.<r/>
 At startup (immediately before executing startup.tjs), Kirikiri searches for files with the tpm extension in the following folders and loads them automatically as plugins:<r />
<ul>
<li>The same folder as the Kirikiri executable</li>
<li>Inside the plugin (or plugin64 for 64-bit versions) folder located in the same directory as the Kirikiri executable</li>
</ul>
<r/>
 Kirikiri sorts the found plugins in ascending order by name and loads them in that sequence. For example, aaa.tpm is loaded before aab.tpm. This is not affected by the folder the plugin is in, only by the plugin's name (even if z.tpm is in the same folder as the Kirikiri executable, if a.tpm is in the plugin folder, a.tpm will be loaded first). If you want to define the loading order of plugins, you must change the plugin filenames.<r/>
</para>

<para>
<ptitle>About Creating Plugins</ptitle>
 The Kirikiri source code includes the source for plugins bundled with Kirikiri, which you can use as a reference.<r/>
 At this stage, the specifications for "Other Kirikiri-specific plugins" are **not finalized**. Even if specifications change in the future, source-level compatibility is expected to be maintained, so even if binary-level compatibility is lost, they should still be usable if rebuilt to match the Kirikiri core.<r/>
</para>

<para>
<ptitle>About Susie Plug-ins</ptitle>
 You can use plugins designed for the image viewer "Susie32" created by Mr. Takechin.<r/>
 You can use 00IN format (image plugins) and 00AM format (archive plugins), but there are the following limitations or Kirikiri-specific behaviors:<r/>
<r/>
<ul>
<li>Since Kirikiri determines the image format by its extension, it cannot handle images with extensions different from the original extension (the one returned by the GetPluginInfo function). (Archives check all supported formats, so they are fine even if the extension is different.)</li>
<li>32bpp bitmaps are treated as bitmaps with an alpha channel.</li>
<li>Some bitmap formats are not accepted (such as those with RLE compression or BITFIELDS specified).</li>
<li>Image loading and archive access via Susie plugins have significantly lower performance compared to image formats and xp3 archives handled natively by Kirikiri.</li>
<li>Since files within an archive are extracted into memory, it is not suitable for handling large files.</li>
<li>Archives within archives are not supported.</li>
<li>Mac binary is not supported.</li>
</ul>
<r/>
 Additionally, some plugins that do not fully comply with the Susie plug-in standard may be incompatible with Kirikiri.<r/>
</para>

<para>
<ptitle>About Plugins Bundled with Kirikiri</ptitle>
 Descriptions of the plugins standardly bundled with Kirikiri.<r/>
<r/>
<dl>
<dt><kw>wuvorbis.dll</kw></dt>
<dd>
 A plugin to enable <kw>OggVorbis</kw> playback in Kirikiri.
</dd>

<dt><kw>wumsadp.dll</kw></dt>
<dd>
 A plugin to enable playback of <kw>Microsoft ADPCM</kw> format .wav files in Kirikiri.
</dd>

<dt><kw>wutcwf.dll</kw></dt>
<dd>
 A plugin to enable playback of <kw>TCWF</kw> format files in Kirikiri.
</dd>

<dt><kw>extrans.dll</kw></dt>
<dd>
 A plugin to extend the types of transitions in the Kirikiri core; connecting it to the core makes several transitions available.<r/>
 Refer to <link href="Transition"/> for how to use this plugin.
</dd>

<dt><kw>dirlist.dll</kw></dt>
<dd>
 A plugin to obtain a list of files within a specified directory.<r/>
 Connecting this plugin makes the <kw>getDirList</kw> function available.<r/>
<tt>getDirList(directory)</tt><r/>
 When specified in this format, it returns a list of all files in that directory as an array. This list also includes directories; in the case of a directory, the element string ends with '/'.<r/>
 Additionally, this list usually includes the two elements './' and '../'.<r/>
 This function only gets the list of files directly under the specified directory and does not recursively get files from subdirectories.
</dd>

<dt><kw>fftgraph.dll</kw></dt>
<dd>
 A plugin to display a simple spectrum analyzer (spec-ana) synchronized with WaveSoundBuffer.<r/>
 Connecting this plugin makes the <kw>drawFFTGraph</kw> function available.<r/>
 Refer to the fftgraph source included in the Kirikiri source and the spec-ana plugin for KAG for usage.
</dd>

<dt><kw>win32ole.dll</kw></dt>
<dd>
 A plugin for embedding ActiveX controls into Kirikiri windows or controlling OLE automation-capable objects from Kirikiri.<r/>
 Using this, you can, for example, embed a web browser (Internet Explorer) or media player into a Kirikiri window, or control Excel from Kirikiri.<r/>
 Refer to the <a href="https://sv.kikyou.info/trac/kirikiri/browser/kirikiri2/trunk/kirikiri2/src/plugins/win32/win32ole/manual.tjs">kirikiri2/trunk/kirikiri2/src/plugins/win32/win32ole/manual.tjs</a> and <a href="https://sv.kikyou.info/trac/kirikiri/browser/kirikiri2/trunk/kirikiri2/tests/win32ole">kirikiri2/trunk/kirikiri2/tests/win32ole</a> directories in the Kirikiri source for usage instructions.<r/>
</dd>

<dt><kw>wsh.dll</kw> (experimental)</dt>
<dd>
 A plugin to enable JScript, VBScript, and PerlScript in Kirikiri (RubyScript support is currently being adjusted).<r/>
 Connecting this plugin extends <at href="f_Scripts_exec.html">Scripts.exec</at> and <at href="f_Scripts_execStorage.html">Scripts.execStorage</at>.<r/>
 Scripts.exec will accept an extension, ProgId, or CLSID as the second argument. Similarly, Scripts.execStorage will accept an extension, ProgId, or CLSID as the second argument; if the second argument is omitted, the language is determined from the extension of the first argument.<r/>
 Extensions are js, vbs, pl, or rb, and ProgIds are JScript, VBScript, PerlScript, and RubyScript, respectively. To specify a CLSID, provide the class ID of the script engine. If any other extension is passed, it will be executed as a TJS script.<r/>
 Refer to the <a href="https://sv.kikyou.info/trac/kirikiri/browser/kirikiri2/trunk/kirikiri2/tests/wsh">kirikiri2/trunk/kirikiri2/tests/wsh</a> directory in the Kirikiri source for usage instructions.<r/>
</dd>


<dt><kw>agg.dll</kw> (experimental)</dt>
<dd>
 A plugin for drawing shapes in Kirikiri using <a href="http://www.antigrain.com/">AGG (Anti-Grain Geometry)</a>.<r/>
 You can use simple SVG loading and drawing features.<r/>
 To draw an SVG, for example, use:
<example>
var svg  = new AGGPrimitive(layer, "SVG", "tiger.svg");<r/>
var svg1 = new AGGPrimitive(layer, "SVG", "tiger.svg");<r/>
</example>
(Due to limitations in the original AGG SVG loading support, many SVGs cannot be loaded).<r/>
 Refer to the <a href="https://sv.kikyou.info/trac/kirikiri/browser/kirikiri2/trunk/kirikiri2/src/plugins/win32/layerExAgg/">kirikiri2/trunk/kirikiri2/src/plugins/win32/layerExAgg</a> directory in the Kirikiri source for details.<r/>
</dd>



<dt><kw>csvParser.dll</kw> (experimental)</dt>
<dd>
 A plugin for reading CSV (Comma Separated Values) files in Kirikiri.<r/>
 Refer to the <a href="https://sv.kikyou.info/trac/kirikiri/browser/kirikiri2/trunk/kirikiri2/src/plugins/win32/csvParser/">kirikiri2/trunk/kirikiri2/